---
title: "Rstudio in Data Science and Paper Writing - Day 2"
author: "Gáspár Jékely"
format:
  revealjs: 
    theme: [default, custom.scss]
    slide-number: false
    code-fold: false
    code-summary: "Code"
    chalkboard: 
      buttons: false
    preview-links: auto
scrollable: true
---

## Course program

::: columns
::: {.column width="50%"}
### Day 1

<br>

-   10:00-12:30 **Part 1** Why open science? Project management, data import, tidy data

-   12:30-13:30 lunch break

-   13:30-17:00 **Part 2**: Plotting, figure assembly
:::

::: {.column width="50%"}
### Day 2

<br>

- 9:30-12:30 **Part 3**: Manuscript writing, tables, references, data and figure embedding

- 12:30-13:30 lunch break

- 13:30-17:00 **Part 4**: GitHub, collaboration, sharing, version control

- 19:00 pub/dinner
:::
:::

```{r eval=TRUE, echo=FALSE}
source("../analysis/scripts/packages_and_functions.R")
```

## Paper writing in Quarto/Rmarkdown

-   Powerful and versatile text editing with simple Markdown syntax or visual editor (similar to Word)

-   Easy insertion and formatting of references from the web or a .bib file

-   Supports equations, tables, code blocks

-   Directly insert your figures generated by your scripts in the same project

-   Can 'knit' into html, pdf or docx formats

-   -\> Open manuscript/Manuscript.qmd\]

## Quarto - Documentation

<br>

-   Quarto enables you to weave together content and executable code into a finished presentation.
-   To learn more about Quarto presentations see <https://quarto.org/docs/presentations/>.

## The YAML header

- A YAML header contains YAML arguments, such as “title”, “author”, and “output”, demarcated by three dashes (-) on either end.
- When you create a new Quarto doc or presentation, it is created with a short YAML

```{r}
#| echo=TRUE, eval=FALSE
---
title: "Untitled"
format: html
---
  
```

- There is a more complex YAML in manuscript/Manuscript.qmd

```{r}
#| echo=TRUE, eval=FALSE

---
title: "New paper template"
subtitle: |
  \raggedright  Author 1^1,2,\*^ , Author 2^1,2^, Author 3^3^, Author 4E^4^ \newline<br>^1^Heidelberg University, Centre for Organismal Studies (COS), 69120 Heidelberg, Germany \newline<br>^2^Affiliation 2 \newline<br>^3^Affiliation 3 \newline<br>^4^Affiliation 4\newline<br>  ^\*^Correspondence: xy@cos.uni-heidelberg.de
mainfont: Arial
monofont: DejaVu Sans Mono #Times New Roman
fontsize: 11pt
linestretch: 1.2
linkcolor: blue
documentclass: article
crossref:
  fig-title: Figure     # (default is "Figure")
max-width: 100%
format:
  html: default
  pdf:
    pdf-engine: xelatex
    number-sections: false
    margin-left: 0.8in
    margin-right: 0.8in
    margin-top: 0.8in
    margin-bottom: 0.8in
    toc: true
    keep-tex: true
    include-in-header:
      text: |
        \usepackage{lineno}
    include-before-body:
      text: |
        \linenumbers
bibliography: references.bib #add bibliography in this file
csl: elife.csl #change according to journal
---
  
```



## Inserting references

<br>

-   In Visual mode, go to 'Insert' -\> 'Citation'
-   search for reference on pubmed etc.
-   'Insert' will add the ref to the bibliograpy.bib file
-   in 'Source' mode, you can directly insert the reference with [@ref_id] (preferred, faster method)
-   add new refs to your .bib file with the command-line command:

:\$ curl -LH "Accept: application/x-bibtex" https://doi.org/10.7554/eLife.34550 \>\> ./references.bib <br>

::: callout-warning
-   need to add references.bib to the YAML header as bibliography: references.bib
-   also define bibliography style in the YAML with csl: elife.csl #add .csl according to journal
:::



## Tables

```{r}
#| echo=TRUE, eval=TRUE

#render built-in iris table with tinytable
tinytable::tt(head(iris))

#create some data
mydata <- tibble(
  gene = c("A", "B"),
  expression = c(1.1, 0.4)
  )

#render table
tt(mydata)

#read data
resources_table <- readxl::read_xls("../analysis/data/Key_resource_table.xls")

tt(
  resources_table, caption = "Key Resources Table", 
  theme = "grid", width = 1
  )

```


## Collaborative code and paper writing with Rstudio and GitHub

<br>

-   GitHub www.github.com is a platform for software development and version control
-   owned by Microsoft since 2018
-   developers can have public and private repositories
-   can share repositories privately with collaborators
-   integrates well with Rstudio
-   uses git protocol that is open source and also used by other code-hosting sites


## The workflow

-   Create a new project or clone a template project on GitHub
-   In Rstudio, New Project -\> Version control -\> add GitHub repo URL and save locally
-   Change the code
-   You can 'commit' and then 'push' changes to GitHub
-   Your collaborators can be added on GitHub
-   Collaborators can 'pull' to their own computer and 'push' their own changes
-   If two developers push changes to the same repo, this can lead to conflict
-   This can be managed by starting new 'branches'
-   Branches can be 'merged' to the original 'master' branch
-   A collaborator can issue a 'pull request' to merge their branch to the master

## Collaborations - sharing and commenting

<br>

-   Adding comments directly to the Quarto file with \<!--# my comment --> (these will not be knitted to the output)
- share as .docx and ask collaborators to use track changes (then why did we take this course...)
- collaborate on the same GitHub repository, use branches and pull requests (only makes sense if the collaborators are very involved)
- in principle you could use an Rproject for data, code and figures, and write text+refs on Gdocs+Paperpile or Overleaf+bib
- share commentable html through your github or other website
- we will use 'https://hypothes.is/' to add commenting functionality to an html 
- you need an account (easy and free)
- we use a https://github.com/hypothesis/client script that is sourced at the end of the quarto file by \<script src="hypothes.is/embed.js" async></script> to make this work

::: callout-warning
- you need to host the html on a website for sharing
:::

## Publication - GitHub and Zenodo integration

<br>

- GitHub is not a publishing platform 
- The owner could delete or make private the entire repo one day after publishing
- To stably publish your code and source data repository with a DOI ( globally unique and persistent identifier), you can use Zenodo
- Launched in 2013 by CERN
- Upload and link your GitHub repo to Zenodo

![](images/zenodo-gradient-1000.png){.absolute top="260" left="550" height="100"}


## Citation

<br>

- add/update a citation (CITATION.cff) file to your repo
- include the Zenodo DOI
- also cite your Zenodo repository in your manuscript
- see [example](https://zenodo.org/records/10978753)
- Make releases of your GitHub repo (e.g. initial submission, version of record), see [example](https://github.com/JekelyLab/Thiel_Yanez_Nematostella/tree/v3.0.0)
- The releases will be shown on Zenodo and are citeable

## Add README file to your repository

<br>

- open the README file (README.Rmd)
- README.md is generated from README.Rmd. Please edit that file
- modify the file according to your project
- add citation of the Zenodo repo with DOI
- add License, Acknowledgements etc.


